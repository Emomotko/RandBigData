---
output: html_document
---
#**ANALIZA PRZYCZYN POPULARNOSCI FILMÓW**

##*Wstêp i pobieranie danych*

Chcia³am zbadaæ jakie cechy maj¹ najbardziej popularne filmy. W tym celu zebra³am dane o "top 500"
filmów z serwisu [Filmweb](http://www.filmweb.pl/).

```{r,echo=FALSE,results="hide"}
#Instalacja i ladowanie bibliotek
#install.packages("rvest")
#install.packages("stringi")
#install.packages("XML")
#library(rvest)
#library(stringi)
#library(XML)
```

Najpierw pobieram ze strony listê tytu³ów najpopularniejszych filmów. Okreœlam 
je jako "najpopularniejsze", gdy¿ sam ranking opiera siê na œredniej ocenie (poprawionej o sta³¹ zapewniaj¹c¹ okreœlon¹ minimaln¹ liczbê wymaganych g³osów) nadanej przez u¿ytkowników serwisu.

```{r,cache=TRUE}
ListaFilmow<-html("http://www.filmweb.pl/rankings/film/world")
ListaFilmowWezly<-html_nodes(ListaFilmow,".place .s-20")
ListaFilmow<-html_text(ListaFilmowWezly)
```

```{r,echo=FALSE,results='asis'}
cat("###**Lista 100 pierwszych Filmów**  \n")
cat("\n\n")
cat("**Miejsce** | **Tytu³** | **Miejsce** | **Tytu³**  \n")
cat("-----------|-------------|-----------|-------------  \n")
  for(i in 1:50){
   cat(i,"|", ListaFilmow[i],"|",i+50,"|", ListaFilmow[i+50],"  \n",sep="")
  }
cat("\n\n\n\n")
```

Chcia³am zanalizowaæ jakie cechy danego filmu czyni¹ go popularnym, st¹d potrzebowa³am podstawowych danych o ka¿dym z filmów.

```{r,cache=TRUE}
LinkiDoFilmow<-html_attr(ListaFilmowWezly,"href")
n<-length(ListaFilmow)
PodstawoweInformacje<-vector("list",n)

for(i in 1:n){
   Tabele<-readHTMLTable(stri_paste("http://www.filmweb.pl",
      LinkiDoFilmow[i]),stringAsFactors=FALSE)
   PodstInf<-Tabele[[1]]
   PodstawoweInformacje[[i]]<-PodstInf
}
```

Podstawowa tabela z informacjami wygl¹da mniej wiêcej tak:

```{r,echo=FALSE}
PodstawoweInformacje[[2]]
```

*Uwaga: Re¿yserzy wczytali siê jako nazwy kolumn st¹d ich wydobycie bêdzie siê ró¿ni³o od wydobycia reszty*

Do analizy by³ jeszcze potrzebny wektor ocen poszczególnych filmów:

```{r,results="hide",cache=TRUE}
Oceny<-html("http://www.filmweb.pl/rankings/film/world")
OcenyWezly<-html_nodes(Oceny,".s-16")
Oceny<-html_text(OcenyWezly) #Wczytane w formacie tekstowym - niestety z przecinakmi jako separatory
Oceny<-stri_replace_all_fixed(Oceny[-1],",",".")
Oceny<-as.double(Oceny)
```

##*Analiza i wnioski*

Najpierw wyci¹gnê³am odpowiednie dane z tabeli:
```{r,cache=TRUE}
#Porzadkuje informacje z tabeli
Rezyserzy<-NULL
Scenarzysci<-NULL
Gatunki<-NULL
KrajeProdukcji<-NULL
   for(i in 1:500){
    Rezyser<-names(PodstawoweInformacje[[i]])[2]
    #Moze byc kilku rezyserow sklejonych ze soba na wzor: "Imie NazwiskoImie Nazwisko"
    Rezyser<-unlist(stri_split_regex(Rezyser,"(?<=\\p{Ll})(?=\\p{Lu})"))
    #Dolaczam ich do ogolnej listy
    Rezyserzy<-c(Rezyserzy,Rezyser)
    
    #Analogicznie kolejne informacje
      #Istnieja tabele,ktore nie maja niektorych wierszy => skomplikowane wyciaganie
    Scenarzysta<-PodstawoweInformacje[[i]][as.character(
       PodstawoweInformacje[[i]][,1])=="scenariusz:",2] 
    Scenarzysta<-unlist(stri_split_regex(Scenarzysta,"(?<=\\p{Ll})(?=\\p{Lu})"))
    Scenarzysci<-c(Scenarzysci,Scenarzysta)
    
    Gatunek<-PodstawoweInformacje[[i]][as.character(
       PodstawoweInformacje[[i]][,1])=="gatunek:",2]
    Gatunek<-unlist(stri_split_regex(Gatunek,"(?<=\\p{Ll})(?=\\p{Lu})"))
    Gatunki<-c(Gatunki,Gatunek)
    
    KrajProdukcji<-as.character(
       PodstawoweInformacje[[i]][as.character(
          PodstawoweInformacje[[i]][,1])=="produkcja:",2])
    KrajProdukcji<-unlist(stri_split_regex(
       KrajProdukcji,"(?<=(\\p{Ll}|USA))(?=\\p{Lu})"))
    KrajeProdukcji<-c(KrajeProdukcji,KrajProdukcji)
   }
```

Uzyskane wyniki przedstawiam na wykresach. Dla ich czytelnoœci bra³am tylko
czêœæ najwy¿ej punktowanych pozycji w danych kategoriach.


```{r}
PodsumowanieRezyserzy<-sort(table(Rezyserzy)[table(Rezyserzy)>3])
barplot(PodsumowanieRezyserzy,
   names.arg=names(PodsumowanieRezyserzy),horiz=TRUE,las=2,col="blue",
   cex.names=0.5,main="Ile filmów nakrêci³ dany re¿yser?",xlab="Iloœæ filmów")
```

Jak widaæ wysoko w rankingu plusuj¹ siê zarówno zagraniczni jak i polscy re¿yserzy, co dla mnie by³o zaskoczeniem, gdy¿ zwykle mówi siê o tym, ¿e Polacy nie doceniaj¹ swoich rodaków artystów.

```{r}
PodsumowanieScenarzysci<-sort(table(Scenarzysci)[table(Scenarzysci)>3])
barplot(PodsumowanieScenarzysci,
   names.arg=names(PodsumowanieScenarzysci),horiz=TRUE,las=2,col="green",
   cex.names=0.5,main="Ile filmów zaplanowa³ dany scenarzysta?",xlab="Iloœæ filmów")
```

Tutaj mo¿na zauwa¿yæ,¿e niektórzy re¿yserzy s¹ tak¿e scenarzystami filmów. Prawdopodobnie 
dziêki temu, ¿e anga¿uj¹ siê tak¿e w scenariuszu ich film ma wiêksze szanse na powodzenie.

```{r}
PodsumowanieGatunki<-sort(table(Gatunki)[table(Gatunki)>10])
barplot(PodsumowanieGatunki,
   names.arg=names(PodsumowanieGatunki),horiz=TRUE,las=2,col="red",
   cex.names=0.5,main="Jakie s¹ najpopularniejsze gatunki filmowe?",xlab="Iloœæ filmów")
```

Kolejne zaskoczenie - prawie po³owa filmów z rankingu popularnoœci jest zaliczana do kategorii "Dramat". Komedie plusuj¹ siê dopiero na trzecim miejscu.

*Uwaga! Je¿eli dany film by³ zaliczany do kilku gatunków lub krajów to zosta³ policzony kilkukrotnie.*

```{r}
PodsumowanieKraje<-sort(table(KrajeProdukcji)[table(KrajeProdukcji)>7]) 
barplot(PodsumowanieKraje,
   names.arg=names(PodsumowanieKraje),horiz=TRUE,las=2,col="purple",
   cex.names=0.5,main="W którym kraju wyprodukowano najwiêcej filmów?",xlab="Iloœæ filmów")
```

Powy¿ej sprawdzi³y siê moje oczekiwania - jesteœmy fanami filmów krêconych w USA :)

Na razie jednak analizowa³am wykresy iloœciowe. Jak zatem ma siê iloœæ do jakoœci?
Zanalizujê to na ostatnim przyk³adzie filmów zkategoryzowanych po krajach produkcji.

```{r,cache=TRUE}
MiejscaProdukcji<-unique(KrajeProdukcji)
OcenaKraju<-vector("numeric",length(MiejscaProdukcji))
names(OcenaKraju)<-MiejscaProdukcji
for(i in 1:500){
     KrajProdukcji<-as.character(
       PodstawoweInformacje[[i]][as.character(
          PodstawoweInformacje[[i]][,1])=="produkcja:",2])
    KrajProdukcji<-unlist(stri_split_regex(
       KrajProdukcji,"(?<=\\p{Ll})(?=\\p{Lu})"))
    OcenaKraju[KrajProdukcji]<-OcenaKraju[KrajProdukcji]+Oceny[i]
}
OcenaKraju<-sort(OcenaKraju/table(KrajeProdukcji)[names(OcenaKraju)],decreasing=TRUE)
```

Tabela pokazuj¹ca œredni¹ ocenê filmów wyprodukowanych w danym kraju:

```{r,echo=FALSE,results='asis'}
cat("###**Œrenia ocena**  \n")
cat("\n\n")
cat("**Kraj** | **Ocena**  \n")
cat("-----------|-------------  \n")
  for(i in 1:length(OcenaKraju)){
   cat(names(OcenaKraju[i]),"|",OcenaKraju[i],"  \n",sep="")
  }
cat("\n\n\n\n")
```

Porównuj¹c z wykresem wy¿ej widzimy, ¿e raczej mamy zale¿noœæ odwrotn¹ - im 
wiêcej filmów tym s¹ one gorzej oceniane.Gorszej jakoœci lub mo¿e po porstu jest przesyt danym typem filmu? Jedynie Niemcy utrzymali dosyæ wysok¹ pozycjê jeœli chodzi o iloœæ i jakoœæ swoich produkcji.
